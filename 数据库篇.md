# 数据库篇

## 1.数据发展过程：

- 文件操作

  ```python
  """
  小飞----123---18
  中飞-456-19
  大飞|789|20
  """
  ```

- 软件开发目录规范

  ```python
  """
  流星蝴蝶剑
  
  - config
  - core
  - lib
  - log
  - bin
  - db
  readme.md
  """
  ```

- 数据库程序

  关系型数据库：

  Mysql、Oracle、SQL server、DB2、Access

  - 数据之间有关系或约束

  - 数据通常以表格的形式储存

    | name（str） | pwd  | age（int） |
    | ----------- | ---- | ---------- |
    | xiaofei     | 123  | 18         |
    | xiaoming    | 258  | 19         |
    | xiaojun     | 368  | 20         |

  非关系型数据库：

  MongoDB、Redis、Memcache

  - 存储数据通常都是key、value的形式
  
    

## 2.Mysql引入

> mysql就是一款基于网络通信的应用程序，底层一定是用的socket

mysql服务端支持自己的客户端操作数据、也支持其他编程语言，**怎么解决语言不通的问题？**

- 让服务端精通所有编程语言
- 统一语言（sql语句）



## 3.MySQL安装

参考mysql安装文档：https://active.clewm.net/FrcyFA



## 4.SQL语句初体验

```sql
-- 启动和连接数据库
net start mysql -- 启动数据库服务(需要管理员权限)
net stop mysql -- 关闭数据库服务(需要管理员权限)
mysql -u root -p -- 连接到数据库

-- 每一条sql语句都是以分号结尾的

-- 库 --> 文件夹
-- 表 --> 文件
-- 记录 --> 文件里面的一行行数据
-- 杠杠是单行注释
/*
多行注释
*/

show databases; --查看所有数据库
\s -- 查看数据库字符编码以及其他信息的
\c -- 结束当前语句，或者用ctrl+c
exit; -- 退出连接
quit; -- 退出连接
help <命令> -- 查看命令的帮助信息
```

* 操作库

```sql
-- 增（create）
create database db1;
create database db1 charset=utf8;  -- 推荐
-- 删（drop）
drop database db2; -- 删除库
-- 改（alter）
alter database db2 charset=utf8; -- 改数据库的字符编码(当前mysql5.1版本之后只能改数据库的字符编码，不能改数据库名称了)
-- 查（show、describe(desc)）
show databases; -- 查所有数据库
show create database db1; -- 查一个，查看创建这个数据库的sql语句
```

* 操作表

```sql
select database(); -- 查看当前所在数据库
use db1; -- 切换数据库
-- 增（create）
create table movies(id int,name char); -- 创建表（默认字符编码，就是库的字符编码）
create table movies(id int,name char) charset=utf8; -- 创建表
-- 删（drop）
drop table movies; -- 删除当前库中的表
-- 改（alter）
alter table movies rename to MOVIES; -- 修改表名
alter table movies modify name char(4); -- 修改表字段类型
alter table movies change name NAME char(5); -- 修改表字段和类型
-- 查（show、describe(desc)）
show tables; -- 查看当前库下所有的表
show create table movies; -- 查看创建这个数据表的sql语句
describe movies; -- 查看一张表的结构，简写：desc movies;

-- 所有对表的操作都可以使用绝对路径的方式，这样即便不操作数据库，也可操作对应数据库的表
create table db.movies(id int,name char(4)) charset=utf8; -- 在指定的库中创建表
drop table db.movies; -- 删除指定库中的表
alter table db.movies change name NAME char(16); -- 修改指定库中表字段和类型
show create table db.movies; -- 查看指定库中的数据库表的sql语句
describe db.movies; -- 查看指定库的一张表的结构，简写：desc db.movies;

```

* 操作记录

```sql
-- 增 (insert into <表名> values())
insert into movies values(1,'流浪地球'); -- 插入一条记录
insert into movies values(1,'流浪地球'),(2,'三体'); -- 插入多条记录
-- 删 (delete from <表名> where)
delete from movies where name='三体';
-- 改 (update xx set)
update movies set name='满江红' where id=1;
-- 查 (select <字段> from <表名>)
select * from db1.movies; -- 查一个表的所有数据
select id,name from db1.movies; -- 查询这张表所有数据的id,name字段
select user,host from mysql.user; -- 查看user表里面所有用户的user字段和host字段
```

## 5.SQl语句分类

| 类型 | 描述                                           | 关键字                       |
| ---- | ---------------------------------------------- | ---------------------------- |
| DDL  | 数据库定义语言，用来定义和管理数据库或者数据表 | create,alter,drop            |
| DML  | 数据操纵语言，用来操作数据                     | insert,update,delete         |
| DQL  | 数据库查询语言，用来查询数据库                 | select                       |
| DCL  | 数据库控制语言，权限控制                       | grant,revoke,commit,rollback |

## 6.库的操作

> 参考之前的笔记

```sql
-- 增（create）
create database [if not exists] <库名> [charset=utf8];
-- 删（drop）
drop database [if not exists] <库名>;
-- 改（alter）
alter database <库名> [charset=utf8];
-- 查（show、describe(desc)）
show databases;
show create database <库名>;
```

## 7.表操作

### **存储引擎**

> 表的类型，就是存储引擎

```sql
show engines; -- 查看所有的存储引擎

'InnoDB':支持事务、行级锁定和外键
'MRG_MYISAM':相同的MyISAM表的集合
'MEMORY':基于哈希，存储在内存中，适用于临时表
'BLACKHOLE':/dev/null存储引擎（您写入其中的任何内容都会消失）
'MyISAM':MyISAM存储引擎
'CSV': CSV存储引擎
'ARCHIVE':归档存储引擎
'PERFORMANCE_SCHEMA': 性能模式
'FEDERATED':联合MySQL存储引擎

Create table t1(id int,name char)engine=innodb;
Create table t2(id int,name char)engine=myisam;
Create table t3(id int,name char)engine=memory;
Create table t4(id int,name char)engine=blackhole;

insert into t1 values(1,'a');
insert into t2 values(1,'a');
insert into t3 values(1,'a');
insert into t4 values(1,'a');

Supports transactions, row-level locking, and foreign keys
```

### 创建表的语法

```sql
create table <表名>(
    <字段名1><字段类型>[(宽度)] [约束条件],
    <字段名2><字段类型>[(宽度)] [约束条件],
    <字段名3><字段类型>[(宽度)] [约束条件],
    <字段名4><字段类型>[(宽度)] [约束条件1,约束条件2]
)engine=innodb charset=utf8;
-- 宽度指的是字符个数，或者说字符串长度，关闭严格模式之后，即便宽度超了，也可以插进去（截取字符），5.6版本之后默认开启严格模式
```

### 修改表的语法

```sql
-- 修改存储引擎
alter table <表名> engine=<存储引擎名称>;

-- 修改表名
alter table <表名> rename to <新表名>;

-- 增加字段
alter table <表名> add <字段名> <字段类型>[(宽度)] [约束条件] [first|after <字段名>];

-- 删除字段
alter table <表名> drop <字段名>;

-- 修改字段
alter table <表名> modify <字段名> <新字段类型>[(宽度)] [约束条件]; -- 修改表字段类型
alter table <表名> change <旧字段名> <新字段名> <新字段类型>[(宽度)] [约束条件]; -- 修改表字段类型和名称
```

### 删除和复制表语法

```sql
-- 删除表
drop table <表名>;

-- 复制创建表
create table <新表名> select * from <旧表名> [条件];

-- 复制创建表结构
create table <新表名> like <旧表名>;

```



